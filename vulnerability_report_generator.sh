#!/bin/bash
output_file="${1}.txt"

# Start the LaTeX document setup
echo '\documentclass[12pt]{article}' > "$output_file"
echo '\usepackage[utf8]{inputenc}' >> "$output_file"
echo '\usepackage{geometry}' >> "$output_file"
echo '\geometry{a4paper, margin=1in}' >> "$output_file"
echo '\usepackage{fancyvrb}' >> "$output_file"
echo '\usepackage{times}' >> "$output_file"  # Using Times font for uniformity
echo '\begin{document}' >> "$output_file"
echo '\setlength{\parindent}{0pt}' >> "$output_file"
echo '\setlength{\parskip}{1em}' >> "$output_file"
echo '\fontsize{12}{14}\selectfont' >> "$output_file"  # Explicitly setting the font size and line spacing

# Function to remove ANSI escape sequences and escape LaTeX special characters in output files
escape_latex_special_chars() {
    sed \
        -e 's/\x1B\[[0-9;]*[mK]//g' \
        -e 's/#/\\#/g' \
        -e 's/_/\\_/g' \
        -e 's/&/\\&/g' \
        -e 's/%/\\%/g' \
        -e 's/\$/\\$/g' \
        -e 's/{/\\{/g' \
        -e 's/}/\\}/g' \
        -e 's/\^/\\textasciicircum{}/g'
}

# Append the results of different scans to the output file, using the escaping function
echo '\newpage' >> "$output_file"
echo 'HTTP Scan' >> "$output_file"
cat http-results.txt | escape_latex_special_chars >> "$output_file"
echo '\newpage' >> "$output_file"
echo '------------------------------------------------' >> "$output_file"
echo "" >> "$output_file"

echo '\newpage' >> "$output_file"
echo 'MICROSOFT-DS SCAN' >> "$output_file"
cat microsoft-ds.txt | escape_latex_special_chars >> "$output_file"
echo '\newpage' >> "$output_file"
echo '------------------------------------------------' >> "$output_file"
echo "" >> "$output_file"

echo '\newpage' >> "$output_file"
echo 'MSRPC SCAN' >> "$output_file"
cat msrpc-results.txt | escape_latex_special_chars >> "$output_file"
echo '\newpage' >> "$output_file"
echo '------------------------------------------------' >> "$output_file"
echo "" >> "$output_file"

echo '\newpage' >> "$output_file"
echo 'MYSQL SCAN' >> "$output_file"
cat mysql-results.txt | escape_latex_special_chars >> "$output_file"
echo '\newpage' >> "$output_file"
echo '------------------------------------------------' >> "$output_file"
echo "" >> "$output_file"

echo '\newpage' >> "$output_file"
echo 'NETBIOS-SSN SCAN' >> "$output_file"
cat netbios-ssn-results.txt | escape_latex_special_chars >> "$output_file"
echo '\newpage' >> "$output_file"
echo '------------------------------------------------' >> "$output_file"
echo "" >> "$output_file"

echo '\newpage' >> "$output_file"
echo 'OPSESSION-PRXY SCAN' >> "$output_file"
cat opsession-prxy-results.txt | escape_latex_special_chars >> "$output_file"
echo '\newpage' >> "$output_file"
echo '------------------------------------------------' >> "$output_file"
echo "" >> "$output_file"

echo '\newpage' >> "$output_file"
echo 'SSH SCAN' >> "$output_file"
cat ssh-results.txt | escape_latex_special_chars >> "$output_file"
echo '\newpage' >> "$output_file"
echo '------------------------------------------------' >> "$output_file"
echo "" >> "$output_file"

echo '\end{document}' >> "$output_file"

# Print Saved File Location
echo "File saved to $output_file"
