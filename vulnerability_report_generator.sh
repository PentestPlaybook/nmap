#!/bin/bash
output_file="${1}.txt"
pdf_source_output_file="${1}.tex"
pdf_output_file="${1}.pdf"

# Start the LaTeX document setup
echo '\documentclass[12pt]{article}' > "$output_file"
echo '\usepackage[utf8]{inputenc}' >> "$output_file"
echo '\usepackage{geometry}' >> "$output_file"
echo '\geometry{a4paper, margin=1in}' >> "$output_file"
echo '\usepackage{fancyvrb}' >> "$output_file"
echo '\usepackage{times}' >> "$output_file"  # Using Times font for uniformity
echo '\usepackage{color}' >> "$output_file"  # Include the color package
echo '\begin{document}' >> "$output_file"
echo '\setlength{\parindent}{0pt}' >> "$output_file"
echo '\setlength{\parskip}{1em}' >> "$output_file"
echo '\fontsize{12}{14}\selectfont' >> "$output_file"  # Explicitly setting the font size and line spacing

# Function to remove ANSI escape sequences and escape LaTeX special characters in output files
escape_latex_special_chars() {
    sed \
        -e 's/\x1B\[[0-9;]*[mK]//g' \
        -e 's/#/\\#/g' \
        -e 's/_/\\_/g' \
        -e 's/&/\\&/g' \
        -e 's/%/\\%/g' \
        -e 's/\$/\\$/g' \
        -e 's/{/\\{/g' \
        -e 's/}/\\}/g' \
        -e 's/\^/\\textasciicircum{}/g'
}

# Append the results of protocol scans to a unified output file for the host
echo '\newpage' >> "$output_file"
echo '\textbf{\color{red}HTTP Scan}' >> "$output_file"
cat http-results.txt | escape_latex_special_chars >> "$output_file"
echo '\newpage' >> "$output_file"

echo '\textbf{\color{red}MICROSOFT-DS SCAN}' >> "$output_file"
cat microsoft-ds.txt | escape_latex_special_chars >> "$output_file"
echo '\newpage' >> "$output_file"

echo '\textbf{\color{red}MSRPC SCAN}' >> "$output_file"
cat msrpc-results.txt | escape_latex_special_chars >> "$output_file"
echo '\newpage' >> "$output_file"

echo '\textbf{\color{red}MYSQL SCAN}' >> "$output_file"
cat mysql-results.txt | escape_latex_special_chars >> "$output_file"
echo '\newpage' >> "$output_file"

echo '\textbf{\color{red}NETBIOS-SSN SCAN}' >> "$output_file"
cat netbios-ssn-results.txt | escape_latex_special_chars >> "$output_file"
echo '\newpage' >> "$output_file"

echo '\textbf{\color{red}OPSESSION-PRXY SCAN}' >> "$output_file"
cat opsession-prxy-results.txt | escape_latex_special_chars >> "$output_file"
echo '\newpage' >> "$output_file"

echo '\textbf{\color{red}SSH SCAN}' >> "$output_file"
cat ssh-results.txt | escape_latex_special_chars >> "$output_file"
echo '\newpage' >> "$output_file"

echo '\end{document}' >> "$output_file"

# Copy the .txt file to a .tex file for LaTeX processing
cp "$output_file" "$pdf_source_output_file"

# Install pdflatex, to allow for PDF conversion
echo "Installing pdflatex" 
sudo apt-get install texlive &> /dev/null

# Convert the .tex file into a PDF document
echo "Generating vulnerability report file"
pdflatex "$pdf_source_output_file" &> /dev/null

# Announce the location of vulnerability report
echo "Vulnerability report file saved to: $pdf_output_file"
